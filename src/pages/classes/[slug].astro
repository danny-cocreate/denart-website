---
export const prerender = true;

import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import CTAButton from '../../components/CTAButton.astro';
import SectionHeader from '../../components/SectionHeader.astro';
import Card from '../../components/Card.astro';
import BookingModal from '../../components/BookingModal.astro';
import FAQ from '../../components/FAQ.astro';
import PretixSchedule from '../../components/PretixSchedule.astro';

export async function getStaticPaths() {
	const classes = await getCollection('classes');
	return classes.map((classItem) => ({
		params: { slug: classItem.slug },
		props: { classItem },
	}));
}

const { classItem } = Astro.props;
const { Content } = await classItem.render();
const galleryImages = classItem.data.galleryImages || [];
const galleryVideo = classItem.data.galleryVideo || null;
const showPrivateNote = classItem.data.showPrivateNote || false;

// Map class slug to Pretix event slug
const CLASS_TO_PRETIX_SLUG: Record<string, string> = {
  'speed-friending': 'speed-friending',
  'uv-body-paint-couples': 'uc-class-couples-2',
};
const pretixEventSlug = CLASS_TO_PRETIX_SLUG[classItem.slug] || 'uc-class-couples-2';
const privateNote = classItem.data.privateNote || "";

// FAQs data
const singlesFAQs = [
  {
    question: "Is nudity allowed?",
    answer: "Not for this event. We support body positivity, but since many people come alone, we want to make sure everyone feels comfortable."
  },
  {
    question: "What if somebody at the event makes me feel unsafe or uncomfortable?",
    answer: "At any point, you can walk away from any interactions that make you feel unsafe or uncomfortable. Our staff will constantly walk around to monitor the interactions to ensure everyone's safety. They will be happy to interfere and remedy the situation if you don't feel comfortable doing so yourself."
  },
  {
    question: "Do I need to have painting experience?",
    answer: "No, absolutely not! Our interactive UV body painting experience is designed for all levels of experience and is meant to be a fun and creative way to express yourself."
  },
  {
    question: "Can I come with a partner and paint only each other?",
    answer: "No. This experience is designed to connect you with new people, not to deepen an established connection that you already have."
  }
];

const couplesFAQs = [
  {
    question: "Is there an age limit to enter the event?",
    answer: "Because of the (partial) nudity involved in the event, you need to be at least 18 years old."
  },
  {
    question: "What do I bring to the class?",
    answer: "We will provide the supplies for the class, so you don't need to bring anything. We do encourage participants to come with ideas for the design(s) that they'd like to paint on their partner or what they'd like to have painted on themselves."
  },
  {
    question: "Can my friend come to the session?",
    answer: "Sorry, this is only for registered students. Having people who don't participate in the class could make some students feel uncomfortable."
  },
  {
    question: "Do I have to be an artist or have some artistic skills?",
    answer: "No. Most people who come to this class don't consider themselves as artistic. The focus of this class is to experiment with body painting and have fun. Our professional artist will be able to provide any help that you may need."
  },
  {
    question: "Can I request what will be painted on me?",
    answer: "Yes, you have the opportunity to decide (together with your partner) what you will paint and what will be painted on your body."
  },
  {
    question: "Do I have to be nude for this class?",
    answer: "No, nudity is not required for this class. Many students prefer to be topless for the class. However, if you don't feel comfortable being topless, you can get the painting on your back and you can cover your front torso."
  }
];

const faqs = classItem.data.category === 'singles' ? singlesFAQs : couplesFAQs;
---

<BaseLayout title={classItem.data.title} description={classItem.data.description}>
	<!-- Hero with Background Image -->
	<section class="relative min-h-[50vh] flex items-center justify-center overflow-hidden">
		{classItem.data.heroImage && (
			<img 
				src={classItem.data.heroImage} 
				alt={classItem.data.title}
				class="absolute inset-0 w-full h-full object-cover object-[center_-100px]"
			/>
		)}
		<div class="absolute inset-0 bg-black/60"></div>
		<div class="relative z-10 text-center px-6">
			<span class="inline-block px-4 py-1.5 rounded-full text-sm font-medium mb-4 uppercase tracking-wide border border-white/30 text-white/80">
				{classItem.data.category === 'singles' ? 'Event' : 'Class'}
			</span>
			<h1 class="text-4xl md:text-6xl font-bold text-white mb-4">{classItem.data.title}</h1>
			<p class="text-xl md:text-2xl text-gray-200 mb-4">UV Body Painting Class for Couples</p>
		</div>
	</section>

	<!-- Intro / Hook Section -->
	<section class="bg-deepest py-12">
		<div class="max-w-4xl mx-auto px-6 text-center">
			{classItem.data.category === 'singles' ? (
				<>
					<h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Make authentic connections</h2>
					<p class="text-xl text-gray-300 max-w-2xl mx-auto">
						A non-nude body painting social event for singles. Meet new people through interactive UV body painting activities designed to help you connect in a fun, low-pressure environment.
					</p>
				</>
			) : (
				<>
					<h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Impress Your Date</h2>
					<p class="text-xl text-gray-300 max-w-2xl mx-auto">
						Not a typical date activity, this UV body painting class for couples at our studio in Brooklyn, NYC will make your date glow (literally) and talk about it for years. This is a romantic and playful experience where couples spend quality time painting each other in a dark studio lit by black lights.
					</p>
				</>
			)}
		</div>
	</section>

	<!-- Where / Price / Schedule Info Bar -->
	{classItem.data.price && (
		<section class="bg-void-light border-y border-zinc-800 py-10">
			<div class="max-w-5xl mx-auto px-6">
				<div class="grid md:grid-cols-3 gap-8">
					<!-- Schedule -->
					<div class="text-center group">
						<div class="w-12 h-12 mx-auto mb-3 rounded-full bg-brand-red/20 flex items-center justify-center">
							<svg class="w-6 h-6 text-brand-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
							</svg>
						</div>
						<p class="text-xs uppercase tracking-widest text-gray-500 mb-3">Schedule</p>
						<PretixSchedule eventSlug={pretixEventSlug} />
					</div>
					
					<!-- Price & Ticket -->
					<div class="text-center group">
						<div class="w-12 h-12 mx-auto mb-3 rounded-full bg-brand-red/20 flex items-center justify-center">
							<svg class="w-6 h-6 text-brand-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
							</svg>
						</div>
						<p class="text-xs uppercase tracking-widest text-gray-500 mb-2">Price</p>
						{classItem.data.earlyBird ? (
							<p class="text-3xl font-bold text-white mb-3">
								{classItem.data.price} <span class="text-lg opacity-70">({classItem.data.earlyBird} Early Bird)</span>
							</p>
						) : (
							<p class="text-3xl font-bold text-white mb-3">{classItem.data.price}</p>
						)}
						<CTAButton onclick="openBookingModal()" variant="primary" size="sm">
							Book Now
						</CTAButton>
						<div class="mt-4 text-sm text-gray-400">
							üéÅ &nbsp;Gift Certificate Available <a href={classItem.data.ticketLink} target="_blank" class="text-brand-red hover:underline ml-1">Buy Now</a>
						</div>
					</div>
					
					<!-- Where -->
					<div class="text-center group">
						<div class="w-12 h-12 mx-auto mb-3 rounded-full bg-brand-red/20 flex items-center justify-center">
							<svg class="w-6 h-6 text-brand-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
							</svg>
						</div>
						<p class="text-xs uppercase tracking-widest text-gray-500 mb-2">Where</p>
						<p class="text-white font-medium">CoCreate Space</p>
						<p class="text-gray-400 text-sm">99 Kingsland Ave #102</p>
						<p class="text-gray-400 text-sm">Brooklyn, NY 11222</p>
						<a 
							href="https://maps.app.goo.gl/uBkAyZiVJTNQCMdz5"
							target="_blank"
							class="text-white hover:text-brand-red text-sm mt-2 inline-block"
						>
							Get directions
						</a>
					</div>
				</div>
				{showPrivateNote && privateNote && (
					<p class="text-gray-300 text-sm mt-6 text-center" set:html={privateNote} />
				)}
			</div>
		</section>
	)}

	<!-- Main Content -->
	<article class="bg-deepest text-text-primary">
		<div class="max-w-4xl mx-auto py-16 px-6">
			<div class="prose prose-lg prose-invert max-w-none 
				prose-headings:text-text-primary 
				prose-h2:text-2xl prose-h2:font-bold prose-h2:mt-12 prose-h2:mb-4
				prose-h3:text-xl prose-h3:font-semibold prose-h3:mt-8 prose-h3:mb-3
				prose-p:text-text-secondary prose-p:leading-relaxed
				prose-ul:list-disc prose-ul:pl-6 prose-li:text-text-secondary prose-li:marker:text-brand-red
				prose-a:text-brand-red prose-a:no-underline hover:prose-a:text-brand-red-light
				prose-blockquote:border-brand-red prose-blockquote:bg-surface/50 prose-blockquote:py-4 prose-blockquote:px-6 prose-blockquote:rounded-lg prose-blockquote:not-italic
				prose-strong:text-text-primary">
				<Content />
			</div>
			
			<!-- Gallery Thumbnails -->
			{(galleryImages.length > 0 || galleryVideo) && (
				<section class="mt-16 py-12">
					<h2 class="text-2xl font-bold text-white mb-8 text-center">Gallery</h2>
					<div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
						{galleryVideo && (
							<button 
								class="aspect-square overflow-hidden rounded-xl cursor-pointer group relative"
								onclick={`openVideoLightbox('${galleryVideo}')`}
								aria-label="Play video"
							>
								<img 
									src={galleryImages.length > 0 ? galleryImages[0] : '/images/classes/placeholder.jpg'} 
									alt="Event video thumbnail"
									class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
								/>
								<div class="absolute inset-0 bg-black/40 flex items-center justify-center group-hover:bg-black/30 transition-colors">
									<div class="w-16 h-16 rounded-full bg-brand-red flex items-center justify-center">
										<svg class="w-8 h-8 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
											<path d="M8 5v14l11-7z"/>
										</svg>
									</div>
								</div>
							</button>
						)}
						{galleryImages.slice(galleryVideo ? 1 : 0).map((img, index) => (
							<button 
								class="aspect-square overflow-hidden rounded-xl cursor-pointer group"
								onclick={`openLightbox('${img}', ${galleryVideo ? index + 1 : index})`}
								aria-label={`View image ${index + 1}`}
							>
								<img 
									src={img} 
									alt={`${classItem.data.title} - Image ${index + 1}`}
									class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
									loading="lazy"
								/>
							</button>
						))}
					</div>
				</section>
			)}
			
			<!-- Testimonial Section -->
			<section class="py-16 bg-void-light/30">
				<div class="max-w-4xl mx-auto text-center px-6">
					<!-- Quote Icon -->
					<svg class="w-12 h-12 text-brand-red/30 mx-auto mb-8" fill="currentColor" viewBox="0 0 24 24">
						<path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"></path>
					</svg>
					
					{classItem.data.category === 'singles' ? (
						<>
							<blockquote class="font-display text-xl md:text-2xl text-sand leading-relaxed mb-8 italic">
								"Such a fun and creative way to build authentic connections with new people! Lots of laughs, great vibes, and the body painting activities made it so easy to break the ice. Highly recommend for anyone looking to meet like-minded singles in a low-pressure environment."
							</blockquote>
							<div class="flex items-center justify-center gap-3 mb-8">
								<div class="w-10 h-10 rounded-full bg-gradient-to-br from-brand-red/30 to-brand-red/10 flex items-center justify-center">
									<span class="font-display text-lg text-brand-red">S</span>
								</div>
								<div class="text-left">
									<p class="font-display text-sand font-medium">Simone</p>
									<p class="text-sand-dim text-sm">Verified Attendee</p>
								</div>
							</div>
						</>
					) : (
						<>
							<blockquote class="font-display text-xl md:text-2xl text-sand leading-relaxed mb-8 italic">
								"This is definitely an intimate activity, excellent for couples, but make sure you are comfortable with other couples in the room! There was a table set with plenty of glowing paints and brushes for our creativity and the instructor offered to help with ideas."
							</blockquote>
							<div class="flex items-center justify-center gap-3 mb-8">
								<div class="w-10 h-10 rounded-full bg-gradient-to-br from-brand-red/30 to-brand-red/10 flex items-center justify-center">
									<span class="font-display text-lg text-brand-red">J</span>
								</div>
								<div class="text-left">
									<p class="font-display text-sand font-medium">Jessie W.</p>
									<p class="text-sand-dim text-sm">Yelp</p>
								</div>
							</div>
						</>
					)}
					
					<a href="/reviews" class="inline-flex items-center gap-2 font-display text-brand-red hover:text-brand-red-light transition-colors group">
						<span>Read more reviews</span>
						<svg class="w-4 h-4 transition-transform duration-200 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
						</svg>
					</a>
				</div>
			</section>
			
			<!-- FAQ Section -->
			<section class="py-16 bg-void-light/30">
				<div class="max-w-4xl mx-auto px-6">
					<FAQ items={faqs} title="Frequently Asked Questions" />
				</div>
			</section>
			
			<!-- CTA Section -->
			<section class="bg-void-light border-y border-zinc-800 py-16 mt-20">
				<div class="text-center">
					<h2 class="text-3xl font-display text-white mb-8">Ready to join this {classItem.data.category === 'singles' ? 'event' : 'class'}?</h2>
				<CTAButton onclick="openBookingModal()" variant="primary" size="lg">
					Book Now
				</CTAButton>
				<div class="mt-4 text-sm text-gray-400">
					üéÅ &nbsp;Gift Certificate Available <a href={classItem.data.ticketLink} target="_blank" class="text-brand-red hover:underline ml-1">Buy Now</a>
				</div>
				</div>
			</section>
		</div>
	</article>

	<!-- Booking Modal -->
	<BookingModal 
		classSlug={classItem.slug}
		classTitle={classItem.data.title}
		price={classItem.data.price}
		earlyBird={classItem.data.earlyBird}
		ticketLink={classItem.data.ticketLink}
		schedule={classItem.data.schedule || []}
		pretixSlug={pretixEventSlug}
	/>

	<!-- Video Lightbox Modal -->
	<div id="video-lightbox" class="fixed inset-0 z-50 hidden bg-black/95 flex items-center justify-center p-4" onclick="closeVideoLightbox(event)">
		<button 
			class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300 transition-colors z-10"
			onclick="closeVideoLightbox(event)"
			aria-label="Close video"
		>
			&times;
		</button>
		<video 
			id="lightbox-video"
			controls 
			autoplay 
			class="max-w-full max-h-[90vh] rounded-lg"
			style="max-width: 720px;"
		>
			Your browser does not support the video tag.
		</video>
	</div>

	<!-- Image Lightbox Modal -->
	<div id="lightbox" class="fixed inset-0 z-50 hidden bg-black/90 flex items-center justify-center p-4" onclick="closeLightbox(event)">
		<button 
			class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300 transition-colors"
			onclick="closeLightbox(event)"
			aria-label="Close lightbox"
		>
			&times;
		</button>
		<button 
			id="lightbox-prev"
			class="absolute left-4 text-white text-4xl hover:text-gray-300 transition-colors"
			onclick="prevImage(event)"
			aria-label="Previous image"
		>
			&#8249;
		</button>
		<img 
			id="lightbox-img" 
			src="" 
			alt="Gallery image" 
			class="max-w-full max-h-[90vh] object-contain rounded-lg"
		/>
		<button 
			id="lightbox-next"
			class="absolute right-4 text-white text-4xl hover:text-gray-300 transition-colors"
			onclick="nextImage(event)"
			aria-label="Next image"
		>
			&#8250;
		</button>
	</div>

	<script is:inline define:vars={{ galleryImages }}>
		let currentIndex = 0;
		const images = galleryImages;

		function openLightbox(src, index) {
			currentIndex = index;
			document.getElementById('lightbox-img').src = src;
			document.getElementById('lightbox').classList.remove('hidden');
			document.getElementById('lightbox').classList.add('flex');
			document.body.style.overflow = 'hidden';
		}

		function closeLightbox(event) {
			if (event.target.id === 'lightbox' || event.target.tagName === 'BUTTON') {
				document.getElementById('lightbox').classList.add('hidden');
				document.getElementById('lightbox').classList.remove('flex');
				document.body.style.overflow = '';
			}
		}

		function prevImage(event) {
			event.stopPropagation();
			currentIndex = (currentIndex - 1 + images.length) % images.length;
			document.getElementById('lightbox-img').src = images[currentIndex];
		}

		function nextImage(event) {
			event.stopPropagation();
			currentIndex = (currentIndex + 1) % images.length;
			document.getElementById('lightbox-img').src = images[currentIndex];
		}

		// Make functions global
		window.openLightbox = openLightbox;
		window.closeLightbox = closeLightbox;
		window.prevImage = prevImage;
		window.nextImage = nextImage;
		
		// Video lightbox functions
		function openVideoLightbox(videoSrc) {
			const video = document.getElementById('lightbox-video');
			const lightbox = document.getElementById('video-lightbox');
			video.src = videoSrc;
			lightbox.classList.remove('hidden');
			lightbox.classList.add('flex');
			video.play();
		}
		
		function closeVideoLightbox(event) {
			if (event.target.id === 'video-lightbox' || event.target.tagName === 'BUTTON' || event.target.tagName === 'VIDEO') {
				const video = document.getElementById('lightbox-video');
				video.pause();
				video.currentTime = 0;
				const lightbox = document.getElementById('video-lightbox');
				lightbox.classList.add('hidden');
				lightbox.classList.remove('flex');
			}
		}
		
		window.openVideoLightbox = openVideoLightbox;
		window.closeVideoLightbox = closeVideoLightbox;
	</script>
</BaseLayout>

---
import { getCollection } from 'astro:content';
import GalleryLayout from '../../layouts/GalleryLayout.astro';
import SectionHeader from '../../components/SectionHeader.astro';
import GalleryGrid from '../../components/GalleryGrid.astro';
import Badge from '../../components/Badge.astro';

export async function getStaticPaths() {
	const items = await getCollection('gallery');
	return items.map((item) => ({
		params: { slug: item.slug },
		props: { item },
	}));
}

const { item } = Astro.props;
const { Content } = await item.render();
const images = item.data.images || [];
const heroImage = images[0];

// Prepare gallery items for GalleryGrid
const galleryItems = images.slice(1).map((img, index) => ({
	slug: `${item.slug}-${index}`,
	title: img.alt || `${item.data.title} - Image ${index + 2}`,
	src: img.src.replace(".avif", ".png")'),
	alt: img.alt || `${item.data.title} - Image ${index + 2}`
}));
---

<GalleryLayout title={`${item.data.title} | Gallery`} description={item.data.description}>
	<main class="min-h-screen" style="background-color: var(--color-bg-deepest);">
		<!-- Dark Hero Header -->
		<section class="relative py-16 px-6 overflow-hidden" style="background: radial-gradient(ellipse at top, rgba(204, 49, 49, 0.25) 0%, transparent 60%), var(--color-bg-deepest);">
			<div class="max-w-4xl mx-auto relative z-10">
				{item.data.category && (
					<Badge text={item.data.category} variant="default" class="mb-4" />
				)}
				<SectionHeader
					title={item.data.title}
					centered={false}
					class="mb-4"
				/>
			</div>
		</section>

		<article class="max-w-4xl mx-auto py-12 px-6" style="background-color: var(--color-bg-deepest);">
			{heroImage && (
				<picture class="block mb-6">
					<source srcset={heroImage.src} type="image/avif" />
					<source srcset={heroImage.src.replace('.avif', '.webp')} type="image/webp" />
					<img 
						src={heroImage.src.replace(".avif", ".png")')} 
						alt={heroImage.alt || item.data.title} 
						class="w-full max-h-[600px] object-contain rounded-lg"
					/>
				</picture>
			)}
			
			{images.length > 1 && (
				<div class="mb-8">
					<GalleryGrid 
						items={galleryItems}
						columns={3}
						showTitles={false}
						aspectRatio="square"
					/>
				</div>
			)}
			
			<div class="prose prose-lg max-w-none prose-invert prose-dark">
				<Content />
			</div>
			
			<div class="mt-8">
				<a href="/gallery" style="color: var(--color-brand-gold);" class="hover:opacity-80 transition-opacity">&larr; Back to Gallery</a>
			</div>
		</article>
	</main>
</GalleryLayout>

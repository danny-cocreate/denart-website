---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const galleryItems = await getCollection('gallery');
const eventItems = await getCollection('events');

// Group by category - get just first image per category
const categories = [
	{ id: 'art-history', name: 'Art History', description: 'Famous art reproductions', collection: 'gallery' },
	{ id: 'asian-influenced', name: 'Asian Influenced', description: 'Dragons, koi, and traditional Asian designs', collection: 'gallery' },
	{ id: 'glow', name: 'Glow / UV', description: 'UV reactive body paintings', collection: 'gallery' },
	{ id: 'original-design', name: 'Original Design', description: 'Unique custom designs', collection: 'gallery' },
	{ id: 'my-body-my-story', name: 'My Body My Story', description: 'Personal meaningful designs', collection: 'gallery' },
	{ id: 'events', name: 'Events & Projects', description: 'Live painting events and workshops', collection: 'events' },
];

// Get first item and count for each category
const categoryData = categories.map(cat => {
	let items = [];
	let featuredItem = null;
	let slug = '';
	
	if (cat.collection === 'gallery') {
		items = galleryItems.filter(item => item.data.category === cat.id);
	} else if (cat.collection === 'events') {
		items = eventItems;
	}
	
	featuredItem = items[0];
	slug = featuredItem?.slug || '';
	
	let src = '';
	let alt = '';
	
	if (featuredItem) {
		if (cat.collection === 'gallery') {
			src = featuredItem.data.images?.[0]?.src?.replace('.avif', '.jpg') || '';
		} else if (cat.collection === 'events' && featuredItem.data.images?.[0]?.src) {
			src = featuredItem.data.images[0].src;
		}
		alt = featuredItem.data.images?.[0]?.alt || featuredItem.data.title || cat.name;
	}
	
	return {
		...cat,
		count: items.length,
		slug,
		src,
		alt
	};
}).filter(cat => cat.count > 0);
---

<BaseLayout title="Body Painting Gallery" description="View our gallery of body painting artwork - art history reproductions, original designs, and UV/glow paintings.">
	<!-- Hero Header -->
	<section class="relative bg-gray-900 py-16 px-6 overflow-hidden">
		<div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_rgba(107,33,168,0.3)_0%,_transparent_60%)]"></div>
		<div class="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,_rgba(212,175,55,0.1)_0%,_transparent_50%)]"></div>
		<div class="max-w-4xl mx-auto relative z-10 text-center">
			<span class="text-brand-red text-sm font-semibold tracking-wider uppercase mb-2 block">Portfolio</span>
			<h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
				Body Painting <span class="text-brand-red">Gallery</span>
			</h1>
			<p class="text-gray-400 text-lg max-w-2xl mx-auto">
				Explore our collection of body painting artwork, from classic art reproductions to original designs.
			</p>
		</div>
	</section>

	<main class="max-w-6xl mx-auto py-16 px-6">
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
			{categoryData.map((cat) => (
				<a href={`/gallery/${cat.id}`} class="group block">
					<div class="relative aspect-[4/3] overflow-hidden rounded-lg mb-4">
						{cat.src ? (
							<img 
								src={cat.src} 
								alt={cat.alt}
								class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
							/>
						) : (
							<div class="w-full h-full bg-gray-800 flex items-center justify-center">
								<span class="text-gray-600 text-4xl">ðŸŽ¨</span>
							</div>
						)}
						<div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
						<div class="absolute bottom-4 left-4 right-4">
							<span class="inline-block bg-brand-red text-white text-xs font-bold px-2 py-1 rounded">
								{cat.count} {cat.count === 1 ? 'piece' : 'pieces'}
							</span>
						</div>
					</div>
					<h2 class="text-xl font-bold text-white group-hover:text-brand-red transition-colors">
						{cat.name}
					</h2>
					<p class="text-gray-400 text-sm">{cat.description}</p>
				</a>
			))}
		</div>
	</main>
</BaseLayout>

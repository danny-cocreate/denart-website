---
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';
import PageHero from '../../components/PageHero.astro';

export async function getStaticPaths() {
  const events = await getCollection('events');
  return events.map((event) => ({
    params: { slug: event.slug },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await event.render();
const images = event.data.images || [];
---

<PageLayout title={event.data.title}>
  <PageHero
    badge="Event"
    title={event.data.title}
    subtitle={event.data.date}
    minHeight="min-h-[40vh]"
    animate={false}
  />

  <main class="max-w-6xl mx-auto py-12 md:py-16 px-6 bg-void">
    {images.length > 0 && (
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-12">
        {images.map((img, index) => (
          <picture class="block aspect-square overflow-hidden rounded-xl border border-zinc-800">
            <source srcset={img.src} type="image/avif" />
            <source srcset={img.src.replace('.avif', '.webp')} type="image/webp" />
            <img 
              src={img.src.replace(".avif", ".png")} 
              alt={img.alt || event.data.title} 
              class="w-full h-full object-cover hover:scale-105 transition-transform duration-500 cursor-pointer"
              loading={index < 4 ? "eager" : "lazy"}
            />
          </picture>
        ))}
      </div>
    )}
    
    <article class="prose prose-lg prose-invert max-w-none 
      prose-headings:font-display
      prose-h2:text-2xl prose-h2:text-sand prose-h2:mt-10
      prose-p:text-sand-muted prose-p:leading-relaxed
      prose-a:text-brand-gold hover:prose-a:text-brand-gold-light
      prose-img:rounded-xl prose-img:shadow-lg">
      <Content />
    </article>
    
    <div class="mt-12 pt-8 border-t border-zinc-800">
      <a href="/events" class="inline-flex items-center gap-2 text-brand-gold hover:text-brand-gold-light transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Back to Events
      </a>
    </div>
  </main>
</PageLayout>
